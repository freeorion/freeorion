Tech
    name = "DEF_GARRISON_1"
    description = "DEF_GARRISON_1_DESC"
    short_description = "TROOPS_SHORT_DESC"
    category = "DEFENSE_CATEGORY"
    researchcost = 5 * [[TECH_COST_MULTIPLIER]]
    researchturns = 3
    tags = [ "PEDIA_DEFENSE_CATEGORY" ]
    prerequisites = "DEF_ROOT_DEFENSE"
    effectsgroups = [
        EffectsGroup
            scope = And [
                Planet
                OwnedBy empire = Source.Owner
            ]
            stackinggroup = "GARRISON_1_TROOPS_STACK"
            accountinglabel = "DEF_GARRISON_1"
            priority = [[TARGET_AFTER_SCALING_PRIORITY]]
            effects = SetMaxTroops value = Value
                        + (NamedReal name = "GARRISON_1_MAX_TROOPS_FLAT" value = 6)
    ]
    graphic = "icons/tech/troops.png"

Tech
    name = "DEF_GARRISON_2"
    description = "DEF_GARRISON_2_DESC"
    short_description = "TROOPS_SHORT_DESC"
    category = "DEFENSE_CATEGORY"
    researchcost = 15 * [[TECH_COST_MULTIPLIER]]
    researchturns = 5
    tags = [ "PEDIA_DEFENSE_CATEGORY" ]
    prerequisites = "DEF_GARRISON_1"
    unlock = Item type = Policy name = "PLC_CHECKPOINTS"
    effectsgroups = [
        EffectsGroup
            scope = And [
                Planet
                OwnedBy empire = Source.Owner
                (LocalCandidate.LastTurnConquered < CurrentTurn)
                (LocalCandidate.LastTurnAttackedByShip < CurrentTurn)
            ]
            priority = [[AFTER_ALL_TARGET_MAX_METERS_PRIORITY]]
            effects = SetTroops value = min(Value(Target.MaxTroops),
                                            Value + (NamedReal name = "GARRISON_2_TROOPREGEN_FLAT" value = 1))

        EffectsGroup
            scope = And [
                Planet
                OwnedBy empire = Source.Owner
                Population low = 0.01
            ]
            stackinggroup = "GARRISON_2_TROOPS_STACK"
            accountinglabel = "DEF_GARRISON_2"
            effects = SetMaxTroops value = Value + Target.Population
                        * (NamedReal name = "GARRISON_2_MAXTROOPS_FLAT" value = 2 * [[TROOPS_PER_POP]])
    ]
    graphic = "icons/tech/troops.png"

Tech
    name = "DEF_GARRISON_3"
    description = "DEF_GARRISON_3_DESC"
    short_description = "TROOPS_SHORT_DESC"
    category = "DEFENSE_CATEGORY"
    researchcost = 50 * [[TECH_COST_MULTIPLIER]]
    researchturns = 7
    tags = [ "PEDIA_DEFENSE_CATEGORY" ]
    prerequisites = "DEF_GARRISON_2"
    effectsgroups = [
        EffectsGroup
            scope = And [
                Planet
                OwnedBy empire = Source.Owner
                (LocalCandidate.LastTurnConquered < CurrentTurn)
                (LocalCandidate.LastTurnAttackedByShip < CurrentTurn)
            ]
            priority = [[AFTER_ALL_TARGET_MAX_METERS_PRIORITY]]
            effects = SetTroops value = min(Value(Target.MaxTroops),
                                            Value + (NamedReal name = "GARRISON_3_TROOPREGEN_FLAT" value = 2))

        EffectsGroup
            scope = And [
                Planet
                OwnedBy empire = Source.Owner
            ]
            stackinggroup = "GARRISON_3_TROOPS_STACK"
            accountinglabel = "DEF_GARRISON_3"
            priority = [[TARGET_AFTER_SCALING_PRIORITY]]
            effects = SetMaxTroops value = Value
                        + (NamedReal name = "GARRISON_3_MAX_TROOPS_FLAT" value = 18)
    ]
    graphic = "icons/tech/troops.png"

Tech
    name = "DEF_GARRISON_4"
    description = "DEF_GARRISON_4_DESC"
    short_description = "TROOPS_SHORT_DESC"
    category = "DEFENSE_CATEGORY"
    researchcost = 150 * [[TECH_COST_MULTIPLIER]]
    researchturns = 9
    tags = [ "PEDIA_DEFENSE_CATEGORY" ]
    prerequisites = "DEF_GARRISON_3"
    effectsgroups = [
        EffectsGroup
            scope = And [
                Planet
                OwnedBy empire = Source.Owner
                (LocalCandidate.LastTurnConquered < CurrentTurn)
                (LocalCandidate.LastTurnAttackedByShip < CurrentTurn)
            ]
            priority = [[AFTER_ALL_TARGET_MAX_METERS_PRIORITY]]
            effects = SetTroops value = min(Value(Target.MaxTroops),
                                            Value + (NamedReal name = "GARRISON_4_TROOPREGEN_FLAT" value = 3))

        EffectsGroup
            scope = And [
                Planet
                OwnedBy empire = Source.Owner
                Population low = 0.01
            ]
            stackinggroup = "GARRISON_4_TROOPS_STACK"
            accountinglabel = "DEF_GARRISON_4"
            effects = SetMaxTroops value = Value + Target.Population *
                (NamedReal name = "GARRISON_4_MAX_TROOPS_FLAT" value = 3 * [[TROOPS_PER_POP]])
    ]
    graphic = "icons/tech/troops.png"

#include "/scripting/common/base_prod.macros"
#include "/scripting/common/priorities.macros"
